{% extends "base.html" %}

{% set breadcrumbs = [
    (url_for('documents'), 'Documents'),
    'Document'
] %}

{% macro overview() %}
    <div class="container">
        <table class="table table-striped table-hover ">
            <thead>
                <tr>
                    <th>Document</th>
                    <th># of Words</th>
                    <th>Topics</th>
                    <th>Words</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <a href="{{ url_for('document', d=doc.d) }}">{{ doc.d }}</a>
                    </td>
                    <td>{{ doc.np }}</td>
                    <td>
                        {% set comma_j = joiner(',') %}
                        {% for t in doc.topics[:5] %}
                            {{ comma_j() }}
                            <a href="{{ url_for('topic', t=t.t) }}" title="P(t | d) = {{ t.np }}">{{ t.t }}</a>
                        {% endfor %}
                        {{ comma_j() }}
                        ...
                    </td>
                    <td>
                        {% set comma_j = joiner(',') %}
                        {% for w in doc.words[:5] %}
                            {{ comma_j() }}
                            <a href="{{ url_for('word', w=w.w) }}" title="N_wd = {{ w.np }}">{{ w.word }}</a>
                        {% endfor %}
                        {{ comma_j() }}
                        ...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-6" id="plot-topics" style="height:400px;"></div>
            <div class="col-md-6" id="plot-words" style="height:400px;"></div>

            <script type="text/javascript">
                $(function () {
                    createPieChart(
                        $('#plot-topics'),
                        'Topics distribution',
                        ['t', 'P(t | d)'],
                        15, 0.01,
                        [
                            {% for t in doc.topics | sort(attribute='np', reverse=True)  %}
                                {
                                    name: '{{ t.t }}',
                                    y: {{ t.np }}
                                },
                            {% endfor %}
                        ]
                    );
                });


                $(function () {
                    createPieChart(
                        $('#plot-words'),
                        'Words distribution',
                        ['w', 'N_wd'],
                        15, 0,
                        [
                            {% for w in doc.words | sort(attribute='np', reverse=True)  %}
                                {
                                    name: '{{ w.word }}',
                                    y: {{ w.np }}
                                },
                            {% endfor %}
                        ]
                    );
                });
            </script>
        </div>

        <div class="row">
            <div class="col-md-12" id="plot-topics-flow" style="height:400px;"></div>

            <script type="text/javascript">
                $(function () {
                    createLineChart(
                        $('#plot-topics-flow'),
                        'Topics flow',
                        ['Word #', 'P'],
                        [
                            {% for tf in topics_flow %}
                                {
                                    name: "Topic {{ tf.t }}",
                                    data: [
                                        {% for p in tf.np %}
                                            [
                                                {{ loop.index }},
                                                {{ p }}
                                            ],
                                        {% endfor %}
                                    ]
                                },
                            {% endfor %}
                        ]
                    );
                });
            </script>
        </div>
    </div>
{% endmacro %}

{% macro content() %}
    <div class="container">
        <div class="well">
            <h4 style="padding: 10px;">
                Topics:
                <div class="dropdown pull-right">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        Highlight
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" onclick="process_data_color('active'); return false;">Active</a></li>
                        <li><a href="#" onclick="process_data_color('passive'); return false;">Passive</a></li>
                        <li><a href="#" onclick="process_data_color('disabled'); return false;">Disabled</a></li>
                    </ul>
                </div>
            </h4>

            <ul class="nav nav-pills">
                {% for t, p in topics %}
                    <li data-color="{{ t }}">
                        <a style="border: 1px solid grey" href="{{ url_for('topic', t=t) }}">
                            <span title="{{ p }}">
                                {{ t }} <!-- <span class="badge">{{ p }}</span> -->
                            </span>
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>

        {% for cw in doc.content %}
            {% if cw.w != -1 %}
                <span data-color="{{ cw.topics.t }}">
                    <a href="{{ url_for('word', w=cw.w) }}" title="Initial form: {{ cw.word_norm }}&#10;# of occurences: {{ cw.np }}">
                        {{ cw.word }}
                    </a>
                </span>
            {% else %}
                {{ cw.word }}
            {% endif %}
        {% endfor %}
    </div>
{% endmacro %}


{% block body %}
<div class="container">
    <div>
        <h3>{{ doc.name }}</h3>
        <div class="bs-component">
            <ul class="nav nav-pills">
                <li class="active"><a href="#overview" data-toggle="tab">Overview</a></li>
                <li><a href="#content" data-toggle="tab">Content</a></li>
            </ul>
            <div class="tab-content" style="padding: 10px;">
                <div class="tab-pane fade active in" id="overview">
                    {{ overview() }}
                </div>
                <div class="tab-pane fade" id="content">
                    {{ content() }}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

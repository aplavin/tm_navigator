{% extends "search_results_base.html" %}
{% import "macros.html" as macros %}

{% set endpoint = 'words:search' %}

{% block body %}
    {% set nmax = words | max(attribute='np') %}

    <h2>{{ 'Matched' if query else 'Top' }} words</h2>
    {% for w in words | sort(attribute='np', reverse=True) %}
        {{ res_cnt_inc() }}
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title pull-left col-sm-4 nofloat">
                    <a href="{{ url_for('word', name=w.w) }}">
                        {{ w.word | safe }}
                    </a>
                </h3>

                <div class="progress col-sm-8 nofloat">
                    <div class="progress-bar progress-bar-default" style="width: {{ w.np/nmax * 100 }}%">
                        <span>
                            N(w) = {{ w.np }}
                        </span>
                    </div>
                </div>
            </div>

            <div class="panel-body">
                <div class="bs-callout bs-callout-info">
                    <h4 class="progress-label">Topics</h4>

                    <ul class="tagcloud">
                        {% for t in w.topics %}
                            <li>
                                <a href="{{ url_for('topic', name=t.t) }}" title="P(w | t) = {{ t.np | round(3) }}" data-size="{{ t.np }}">{{ t.t }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="bs-callout bs-callout-info">
                    <h4 class="progress-label">Documents</h4>

                    <ul class="tagcloud">
                        {% for d in w.documents[:30] %}
                            {{ macros.document_in_tagcloud(d.meta['slug'], d.np, 'N(w, d) = %d', d.meta['title'], d.meta['authors']) }}
                        {% endfor %}

                        {% if w.documents|length > 30 %}
                            <li>&hellip;&nbsp;{{ w.documents|length - 30 }}&nbsp;more&nbsp;&hellip;</li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    {% endfor %}
{% endblock %}

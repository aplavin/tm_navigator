{% extends "search_results_base.html" %}
{% import "macros.html" as macros %}

{% set endpoint = 'words:search' %}

{% block body %}
    {% set nmax = words | max(attribute='np') %}

    <h2>{{ 'Matched' if query else 'Top' }} words</h2>
    {% for w in words | sort(attribute='np', reverse=True) %}
        {{ res_cnt_inc() }}
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title pull-left col-sm-4 nofloat">
                    <a href="{{ url_for('word', name=w.w) }}">
                        {{ w.word | safe }}
                    </a>
                </h3>

                <div class="progress col-sm-8 nofloat">
                    <div class="progress-bar progress-bar-default" style="width: {{ w.np/nmax * 100 }}%">
                        <span>
                            N(w) = {{ w.np }}
                        </span>
                    </div>
                </div>
            </div>

            <div class="panel-body">
                <div class="bs-callout bs-callout-info">
                    <h4 class="progress-label">Topics</h4>

                    {% call(t) macros.tagcloud(w.topics) %}
                        <a href="{{ url_for('topic', name=t.t) }}" title="P(w | t) = {{ t.np | round(5) }}" data-size="{{ t.np }}">{{ t.t }}</a>
                    {% endcall %}
                </div>

                <div class="bs-callout bs-callout-info">
                    <h4 class="progress-label">Documents</h4>

                    {% call(d) macros.tagcloud(w.documents, 20) %}
                        {{ macros.document_in_tagcloud(d.meta['slug'], d.np, 'N(w, d) = %d', d.meta['title'], d.meta['authors']) }}
                    {% endcall %}
                </div>
            </div>
        </div>
    {% endfor %}
{% endblock %}
